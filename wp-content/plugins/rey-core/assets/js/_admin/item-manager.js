!function(e){"use strict";var t={$wrapper:e(".rey-itemManager-wrapper"),allItems:[],itemsNotInUse:[],categories:{},init:function(){this.$container=e(".rey-itemManager",this.$wrapper),this.$items=e(".rey-itemManager-item[data-item]",this.$container),this.$scanBtn=e(".elManager-scanButton",this.$wrapper),this.$scanBtnperc=e(".__perc",this.$scanBtn),this.$disableUnusedBtn=e(".elManager-disableUnused",this.$wrapper),this.$activateAll=e(".elManager-activateAll",this.$wrapper),this.$deactivateAll=e(".elManager-deactivateAll",this.$wrapper),this.$header=e(".rey-itemManager-header",this.$wrapper),this._type=this.$wrapper.attr("data-type"),this.scannedItems="rey_scanned_items_"+this._type,this.$search=e(".rey-itemManager-search input[type='search']",this.$wrapper),this.$filterMenu=e(".rey-itemManager-filterMenu",this.$wrapper),this.$items.each((function(a,s){t.allItems.push(e(s).attr("data-item"))})),e('.rey-itemManager-filterMenu[data-type="category"] a:not([data-key="all"])',this.$wrapper).each((function(){t.categories[this.getAttribute("data-key")]=parseInt(this.getAttribute("data-count")||0)})),this.events()},events:function(){var a=this;e(".rey-toggleSwitch-label",this.$items).on("click",(function(t){t.preventDefault();var a=e(this).closest(".rey-itemManager-item"),s=e('input[type="checkbox"]',a);a.is("[data-status='enabled']")?s.prop("checked",!1).trigger("change"):s.prop("checked",!0).trigger("change")})),e('input[type="checkbox"]',this.$items).on("change",(function(s){var i=e(s.target),n=i.closest(".rey-itemManager-item"),r=n.attr("data-item");n.addClass("--disabled");var c=i.prop("checked");rey.ajax.request("change_item_status_"+a._type,{data:{status:c,item:r},cb:function(e){e&&e.data&&(c?(n.attr("data-status","enabled"),i.prop("checked",!0)):(n.attr("data-status","disabled"),i.prop("checked",!1))),n.removeClass("--disabled"),t.updateCounters()}})})),this.$scanBtn.on("click",(function(t){t.preventDefault();var s=e(this),i=rey.util.ls.get(a.scannedItems);if(i)return a.itemsNotInUse=i,void a.finishedScanning();a.lockClicks(),s.addClass("--loading"),a.$items.removeClass("--not-in-use"),a.runScan()})),this.$disableUnusedBtn.on("click",(function(t){t.preventDefault();var s=e(this);a.lockClicks(),s.addClass("--loading"),rey.ajax.request("disable_unused_items_"+a._type,{data:{items:a.itemsNotInUse},cb:function(e){e&&e.success&&(s.children("span:first-child").text(reyCoreAdmin.strings.reloading),setTimeout((function(){location.reload()}),1e3),a.unlockClicks())}})})),this.$activateAll.on("click",(function(t){t.preventDefault();var s=e(this);a.lockClicks(),s.addClass("--loading"),rey.ajax.request("activate_all_"+a._type,{cb:function(e){e&&e.success&&e.data&&a.runActDeact(s)}})})),this.$deactivateAll.on("click",(function(t){t.preventDefault();var s=e(this);a.lockClicks(),s.addClass("--loading"),rey.ajax.request("deactivate_all_"+a._type,{cb:function(e){e&&e.success&&a.runActDeact(s)}})})),e(window).on("scroll",(function(){a.$header.toggleClass("--sticked",0!==(window.pageYOffset||document.documentElement.scrollTop))})),this.$search.on("input",_.debounce((function(a){var s=a.target.value,i=new RegExp(s,"gi");if(t.$container.removeClass("--filtering").addClass("--searching"),t.$container.children("h2").removeClass("--empty"),t.$items.removeClass("--visible"),""===s)return t.$container.removeClass("--searching"),void t.$container.children("h2");e.each(t.$items,(function(t,a){var s=e(a),n=e("h2",s).text(),r=e(".rey-itemManager-itemDesc",s).text();(n.match(i)||r.match(i))&&s.addClass("--visible")})),t.checkCategories()}),200));var s=!1;e(document).on("click",(function(t){if(t.target.closest(".elManager-toggleButtons-icon")){t.preventDefault();var a=e(".elManager-toggleButtons");s?(a.removeClass("--active"),s=!1):(a.addClass("--active"),s=!0)}else s&&(e(".elManager-toggleButtons").removeClass("--active"),s=!1)})),this.filters={},e(document).on("click",".rey-itemManager-filterMenu a",(function(a){a.preventDefault();var s=e(this);if(!s.hasClass("current")){var i=s.closest(".rey-itemManager-filterMenu");e("a",i).removeClass("current"),s.addClass("current");var n=i.attr("data-type");t.filters[n]=s.attr("data-key"),t.runFilters()}}))},runFilters:function(){this.$items.removeClass("--visible");var e="";Object.keys(this.filters).forEach((function(a){var s=t.filters[a];"all"!==s&&(e+=`[data-${a}="${s}"]`)})),e=e||"[data-item]",this.$items.filter(e).addClass("--visible"),this.$container.removeClass("--searching").addClass("--filtering"),this.checkCategories()},checkCategories:function(){e("h2",t.$container).removeClass("--empty"),e.each(this.categories,((a,s)=>{s===t.$items.filter('[data-category="'+a+'"]:not(.--visible)').length&&e('h2[data-value="'+a+'"]',t.$container).addClass("--empty")}))},updateCounters:function(){if(this.$filterMenu.length){var t=parseInt(e('a[data-key="all"]',this.$filterMenu).attr("data-count")||0);if(t){var a=e('.rey-itemManager-item:not([data-key="enabled"])',this.$container).length;e('a[data-key="disabled"]',this.$filterMenu).attr("data-count",a),e('a[data-key="enabled"]',this.$filterMenu).attr("data-count",t-a)}}},runActDeact:function(e){this.unlockClicks(),localStorage.removeItem(this.scannedItems),e.children("span:first-child").text(reyCoreAdmin.strings.reloading),setTimeout((function(){location.reload()}),1e3)},runScan:function(t){var a=this;t=t||0;var s=Math.floor(100/a.allItems.length*(t+1));s>100&&(s=100),this.$scanBtnperc.text(s),rey.ajax.request("scan_unused_items_"+this._type,{data:{item:this.allItems[t]},cb:function(s){s&&s.success&&(!1===s.data&&(-1===a.itemsNotInUse.indexOf(t)&&a.itemsNotInUse.push(a.allItems[t]),e('.rey-itemManager-item[data-item="'+a.allItems[t]+'"]',a.$wrapper).addClass("--not-in-use")),a.allItems.length>t+1?a.runScan(t+1):(a.unlockClicks(),a.finishedScanning(!0)))}})},finishedScanning:function(t){var a=this;this.$scanBtn.removeClass("--loading"),this.itemsNotInUse.length&&(t?rey.util.ls.set(this.scannedItems,this.itemsNotInUse,12e4):e.each(this.itemsNotInUse,(function(t,s){e('.rey-itemManager-item[data-item="'+s+'"]',a.$wrapper).addClass("--not-in-use")})),this.$disableUnusedBtn.text(this.$disableUnusedBtn.text().replace("{{count}}",this.itemsNotInUse.length)).show())},lockClicks:function(){this.$wrapper.addClass("--locked")},unlockClicks:function(){this.$wrapper.removeClass("--locked")},diff:function(e,t){for(var a=[],s=[],i=0;i<e.length;i++)a[e[i]]=!0;for(i=0;i<t.length;i++)a[t[i]]?delete a[t[i]]:a[t[i]]=!0;for(var n in a)s.push(n);return s}};t.init()}(jQuery);