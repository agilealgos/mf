!function(e){"use strict";var t={statusDefault:"init",iName:"mini-cart",debug:!1,somethingChanged:!0,triggerOpen:!1,isOpen:!1,hasBeenOpened:!1,assetsFragmentName:"_cart_assets_",cartButtonSelector:".js-rey-headerCart",cartPanelSelector:".js-rey-cartPanel",init:function(){if(this.$cartPanel=e(this.cartPanelSelector),this.cartTrigger=document.querySelectorAll(this.cartButtonSelector),this.cartPanel=document.querySelector(this.cartPanelSelector),this.cartPanel){this.status=this.statusDefault;var t={name:"mini-cart",trigger:this.cartTrigger,panel:this.cartPanel,closeBtn:".rey-cartPanel-header",extraBodyClass:"--cart-active",manualOpen:!0,onClose:this.close};return rey.params.header_cart_panel&&rey.params.header_cart_panel.close_text&&(t.closeText=rey.params.header_cart_panel.close_text),this.SP=rey.components.sidePanel(t),this.events(),rey.hooks.doAction("minicart/init",this),this}},events:function(){e(document).on("click",this.cartButtonSelector,(function(e){e.preventDefault();var a=this;a.classList.contains("--cart-checkout")||rey.params.disable_header_cart_panel?window.location.href=a.getAttribute("data-href"):rey.vars.is_global_section_mode||rey.elements.body.classList.contains("woocommerce-cart")||rey.elements.body.classList.contains("woocommerce-checkout")||(t.loaderTimeout=setTimeout((()=>{a.classList.add("--loading")}),200),t.triggerOpen=!0,t.open())})),this.cartPanel.addEventListener("click",(function(e){e.target.closest(".rey-cartPanel-continue button")&&(e.preventDefault(),t.closePanel())})),e(document).on("change",".rey-cartPanel input.qty",(function(a){var n=e(this),o=n.closest(".woocommerce-mini-cart-item"),r=e("a.remove",o),c=parseFloat(n.attr("max")||0);a.preventDefault(),c&&parseFloat(n.val())>c&&n.val(c),o.addClass("--loading"),e.ajax({type:"POST",url:rey.params.wc_ajax_url.toString().replace("%%endpoint%%","rey_update_minicart"),data:{cart_item_key:r.data("cart_item_key"),cart_item_qty:n.val(),security:rey.params.ajax_nonce},success:function(a){a&&a.fragments?(e.each(a.fragments,(function(t){e(t).fadeTo("400","0.6").addClass("--no-click")})),e.each(a.fragments,(function(t,a){e(t).replaceWith(a),e(t).stop(!0).css("opacity","1").removeClass("--no-click")})),e(document.body).trigger("wc_fragments_loaded"),rey.hooks.doAction("minicart/updated",t)):window.location=r.attr("href")},error:function(){e("<p><small>"+rey.params.cannot_update_cart+"</small></p>").appendTo(o),setTimeout((function(){window.location.reload()}),1e3)},dataType:"json"})})),e(document).on("click",".woocommerce-mini-cart-item a.remove",(function(t){e(this).closest(".woocommerce-mini-cart-item").addClass("--loading")})),e(document.body).on("added_to_cart removed_from_cart wc_fragments_refreshed updated_wc_div wc_fragments_loaded",(function(e){t.refreshScroll()})),e(document.body).on("adding_to_cart",(function(e){t.status="adding",t.triggerOpen=!0})),e(document.body).on("added_to_cart",(function(a,n,o,r){if(t.status="added","yes"!==wc_add_to_cart_params.cart_redirect_after_add){if(r.length&&r.is("[data-checkout]"))return rey.hooks.removeAction("minicart/open"),void(window.location=r.attr("data-checkout"));if(!(r.length&&r.hasClass("--prevent-open-cart")||"cart"!==rey.params.after_add_to_cart))if(e("body.woocommerce-cart").length){var c=e(".woocommerce-cart-form");c.length&&e("html,body").animate({scrollTop:c.offset().top},"slow")}else t.activateTab(),t.open()}})),e(document.body).on("removed_from_cart",(function(e,a){t.status="removed",void 0!==a._count_&&(a._count_||t.emptyGs(),t.updateCountAttribute(a))})),e(document.body).on("wc_fragments_loaded",(function(e){t.log(":: LOADED FRAGMENTS"),t.updateCountAttribute(),t.somethingChanged=!0})),e(document.body).on("wc_fragments_refreshed",(function(e){t.log(":: REFRESHED FRAGMENTS"),t.willRefreshFragments=!1,t.open()})),e(document.body).on("wc_cart_button_updated",(function(e,t){t.next(".added_to_cart").remove()})),rey.hooks.addAction("minicart/open",(function(){t.triggerOpen=!0,t.open()})),e(".__tab",t.$cartPanel).on("click",(function(){var a=e(this).attr("data-item");t.activateTab(a)})),e(document).on("click",'.rey-cartPanel .coupon button[name="apply_coupon"]',(function(e){e.preventDefault(),t.apply_coupon()})),e(document).on("click",".rey-cartPanel .woocommerce-remove-coupon",(function(e){e.preventDefault(),t.remove_coupon(this)}))},updateCountAttribute:function(e){void 0!==(e=e||t.getFragments())._count_&&document.querySelectorAll("[data-rey-cart-count]").forEach((t=>{t.setAttribute("data-rey-cart-count",e._count_)}))},getFragments:function(){return"undefined"==typeof wc_cart_fragments_params?{}:wc_cart_fragments_params.fragment_name&&JSON.parse(sessionStorage.getItem(wc_cart_fragments_params.fragment_name))||{}},open:function(){if("undefined"==typeof wc_cart_fragments_params)return console.log("Cart Fragments script is not loaded. Probably a 3rd party plugin has disabled it."),t.__openPanel();t.log(":: CART-OPEN");var a=t.getFragments();if(rey.validation.isEmptyObject(a))e(document.body).trigger("wc_fragment_refresh");else if(!t.willRefreshFragments||t.hasBeenOpened){if(t.triggerOpen){if(t.triggerOpen=!1,!a||!(t.assetsFragmentName in a))return t.__openPanel();rey.assets.lazyAssets(a[t.assetsFragmentName],(function(){rey.hooks.doAction("minicart/assets_ready",t),setTimeout((function(){t.__openPanel()}),200)}))}}else e(document.body).trigger("wc_fragment_refresh")},__openPanel:function(){this.SP.open(),clearTimeout(t.loaderTimeout),this.cartTrigger.forEach((e=>{e.classList.remove("--loading")})),rey.hooks.doAction("minicart/opened",t),this.refreshScroll(),this.emptyGs(),this.isOpen=!0,this.hasBeenOpened=!0,this.assetsLoaded=!0},closePanel:function(){t.SP.close(),t.close()},close:function(){t.isOpen=!1,t.somethingChanged=!1,t.status=t.statusDefault,t.log(":: CART-CLOSE"),rey.hooks.doAction("minicart/close",t)},activateTab:function(t){t=t||"cart",e(".__tab",this.$cartPanel).removeClass("--active"),e('.__tab[data-item="'+t+'"]',this.$cartPanel).addClass("--active"),e(".__tab-content",this.$cartPanel).removeClass("--active"),e('.__tab-content[data-item="'+t+'"]',this.$cartPanel).addClass("--active"),rey.hooks.doAction("minicart/tab",t,this)},apply_coupon:function(){var t=e(".rey-toggleCoupon",this.$cartPanel),a=e("#coupon_code",this.$cartPanel),n=e(".rey-toggleCoupon-response",this.$cartPanel),o=a.val(),r={security:rey.params.header_cart_panel.apply_coupon_nonce,coupon_code:o};t.addClass("--loading"),e.ajax({type:"POST",url:woocommerce_params.wc_ajax_url.toString().replace("%%endpoint%%","apply_coupon"),data:r,dataType:"html"}).done((function(o){n.empty(),n.html(o),t.removeClass("--loading"),a.val(""),e(document.body).trigger("wc_fragment_refresh")}))},remove_coupon:function(t){var a=e(t),n=(e(".rey-toggleCoupon",this.$cartPanel),e("#coupon_code",this.$cartPanel)),o=e(".rey-toggleCoupon-response",this.$cartPanel),r=a.attr("data-coupon"),c=e(".minicart-total-row.coupon-"+r,this.$cartPanel),s={security:rey.params.header_cart_panel.remove_coupon_nonce,coupon:r};c.addClass("--loading"),e.ajax({type:"POST",url:woocommerce_params.wc_ajax_url.toString().replace("%%endpoint%%","remove_coupon"),data:s,dataType:"html"}).done((function(t){o.empty(),o.html(t),c.removeClass("--loading"),n.val(""),e(document.body).trigger("wc_fragment_refresh")}))},emptyGs:function(){var a=e(".rey-emptyMiniCartGs");if(a.length&&!a.html()){var n=a.attr("data-gsid");if(n)return t.emptyGsContent?a.append(t.emptyGsContent):void rey.ajax.request("get_empty_minicart_gs_content",{ss:!0,data:{gsid:n},params:{cache:!1},cb:function(e){a.append(e.data),t.emptyGsContent=e.data}})}},refreshScroll:function(){var e=this.cartPanel.querySelector(".woocommerce-mini-cart");e&&"undefined"!=typeof SimpleScrollbar&&SimpleScrollbar.initEl(e)},log:function(e){this.debug&&console.log(e)}};e(document).ready((function(){rey&&(rey.components.minicart=t.init())})),e(document.body).on("wc_fragments_refresh_empty",(function(){rey.params.header_cart_panel.cart_fragment_tweak?t.willRefreshFragments=!0:e(document.body).trigger("wc_fragment_refresh")})),e(document.body).on("adding_to_cart wc_fragments_refreshed",(function(){t.willRefreshFragments=!1}))}(jQuery);